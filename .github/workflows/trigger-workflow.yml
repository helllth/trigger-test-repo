name: Trigger Target Workflow

on:
  workflow_dispatch:
    inputs:
      project-name:
        description: "Please enter a project name"
        required: true

jobs:
  trigger:
    runs-on: ubuntu-latest

    steps:
      - name: Trigger Workflow in Another Repository
        run: |
          # Set the required variables
          repo_owner="helllth" 
          repo_name="carma"  
          event_type="trigger-workflow" 
          versionManipulator=""
          projectName="${{ github.event.inputs.project-name }}"
          actor="${{ github.actor }}"
          target="dev"

          # Dynamically construct the client_payload
          if [ -z "$versionManipulator" ]; then
            # versionManipulator is empty, so exclude it
            payload=$(cat <<EOF
{
  "event_type": "$event_type", 
  "client_payload": {
    "project-name": "$projectName",
    "target": "$target",
    "actor": "$actor",
    "unit": false,
    "integration": true
  }
}
EOF
)
          else
            # versionManipulator is set, include it
            payload=$(cat <<EOF
{
  "event_type": "$event_type", 
  "client_payload": {
    "project-name": "$projectName",
    "target": "$target",
    "version-manipulator": "$versionManipulator",
    "actor": "$actor",
    "unit": false,
    "integration": true
  }
}
EOF
)
          fi

          # Print the payload (optional, for debugging purposes)
          echo "Payload: $payload"

          # Send the request
          curl -L \
            -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${{ secrets.CISMET_CI_DEPLOY2_PAT }}" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            https://api.github.com/repos/$repo_owner/$repo_name/dispatches \
            -d "$payload"